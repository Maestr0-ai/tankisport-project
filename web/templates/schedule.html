{% extends "base.html" %}
{% block content %}

<h1>Матчи</h1>

<div class="matches">

{% for m in matches %}
  {% if not m.is_finished %}
  <div class="match-card" data-start="{{ m.start_iso }}">

    <!-- ВЕРХ -->
    <div class="match-top">
      <span class="match-datetime">{{ m.start_display }}</span>

      <span class="match-status">
        {% if m.is_live %}
          <span class="live">
            <span class="live-dot"></span> LIVE ·
            <span class="duration">00:00:00</span>
          </span>
        {% else %}
          <span class="countdown">⏳</span>
        {% endif %}
      </span>
    </div>

    <!-- ЦЕНТР -->
    <div class="match-row">
      <div class="team left">{{ m.team1 }}</div>
      <div class="vs">VS</div>
      <div class="team right">{{ m.team2 }}</div>
    </div>

  </div>
  {% endif %}
{% endfor %}

</div>

<script>
function pad(n){return n.toString().padStart(2,"0");}

function updateMatches(){
  const now = new Date();

  document.querySelectorAll(".match-card").forEach(card=>{
    const start = new Date(card.dataset.start);
    const diff = start - now;

    const countdown = card.querySelector(".countdown");
    const duration = card.querySelector(".duration");

    if (!countdown || !duration) return;

    if (diff > 0){
      const h = Math.floor(diff/1000/3600);
      const m = Math.floor((diff/1000%3600)/60);
      const s = Math.floor(diff/1000%60);
      countdown.textContent = `⏳ ${pad(h)}:${pad(m)}:${pad(s)}`;
    } else {
      const liveSec = Math.floor((now-start)/1000);
      duration.textContent =
        `${pad(Math.floor(liveSec/3600))}:${pad(Math.floor(liveSec%3600/60))}:${pad(liveSec%60)}`;
    }
  });
}

updateMatches();
setInterval(updateMatches,1000);
</script>

{% endblock %}
